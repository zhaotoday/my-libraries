{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import axios from 'axios'\r\n\r\n/**\r\n * 基于 axios 的 RESTful HTTP 简单封装\r\n * @author 赵金添 <729234283@qq.com>\r\n */\r\nexport default class REST {\r\n  /**\r\n   * 构造方法\r\n   */\r\n  constructor () {\r\n    /**\r\n     * 接口基础地址\r\n     * @type {string}\r\n     */\r\n    this.baseURL = ''\r\n\r\n    /**\r\n     * 接口版本\r\n     * @type {string}\r\n     */\r\n    this.version = ''\r\n\r\n    /**\r\n     * 请求路劲\r\n     * @type {string}\r\n     */\r\n    this.path = ''\r\n\r\n    /**\r\n     * Headers\r\n     * @type {Object}\r\n     */\r\n    this.headers = {}\r\n\r\n    // 支持的请求方式\r\n    const methods = ['GET', 'POST', 'PATCH', 'PUT', 'DELETE']\r\n\r\n    // 注册方法到 this\r\n    methods.forEach((method) => {\r\n      this[method] = options => this.request(method, options)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 请求\r\n   * @param {string} method='GET' 请求方式\r\n   * @param {Object} [options={}] 选项\r\n   * @param {string} [options.id=''] 资源唯一标示，一般是 ID\r\n   * @param {Object} [options.query=null] GET 参数\r\n   * @param {Object} [options.body=null] POST/PUT/PATCH 数据\r\n   * @return {Object}\r\n   */\r\n  request (method = 'GET', options = {}) {\r\n    const { id = '', query = null, body = null, timeout = 5000 } = options\r\n    let url = this.version ? `/${this.version}/${this.path}` : `/${this.path}`\r\n\r\n    if (id) {\r\n      url = `${url}/${id}`\r\n    }\r\n\r\n    // GET\r\n    if (query) {\r\n      url = `${url}${this.toURL(query)}`\r\n    }\r\n\r\n    return typeof wx !== 'undefined' && wx.request\r\n      ? new Promise((resolve, reject) => {\r\n        wx.request({\r\n          url: this.baseURL + url,\r\n          header: this.headers,\r\n          method,\r\n          data: body,\r\n          success: res => {\r\n            if ((res.statusCode + '').charAt(0) === '2') {\r\n              resolve(res)\r\n            } else {\r\n              reject(res)\r\n            }\r\n          },\r\n          fail: reject\r\n        })\r\n      })\r\n      : axios({\r\n        baseURL: this.baseURL,\r\n        headers: this.headers,\r\n        method,\r\n        timeout,\r\n        url,\r\n        data: body\r\n      })\r\n  }\r\n\r\n  /**\r\n   * 对象转 URL\r\n   * @param {Object} obj 待转化对象\r\n   * @return {string}\r\n   */\r\n  toURL (obj) {\r\n    if (!obj || !Object.keys(obj).length) {\r\n      return ''\r\n    }\r\n\r\n    return '?' + Object.keys(obj).map(key => `${key}=${encodeURIComponent(obj[key])}`).join('&')\r\n  }\r\n\r\n  /**\r\n   * 附加路劲\r\n   * @param {string} [path=''] 路劲\r\n   */\r\n  addPath (path = '') {\r\n    this.path = `${this.path}/${path}`\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 添加 Headers\r\n   * @param {Object} headers Headers\r\n   */\r\n  addHeaders (headers) {\r\n    Object.assign(this.headers, headers)\r\n\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * 路劲参数替换\r\n   * @param {Object} options={} 路劲参数列表\r\n   */\r\n  replace (options = {}) {\r\n    Object.keys(options).forEach(value => {\r\n      this.path = this.path.replace(new RegExp(`{${value}}`, 'img'), options[value])\r\n    })\r\n\r\n    return this\r\n  }\r\n}\r\n"],"names":["REST","baseURL","version","path","headers","forEach","method","_this","request","options","id","query","body","timeout","url","this","toURL","wx","Promise","resolve","reject","_this2","res","statusCode","charAt","axios","obj","Object","keys","length","map","key","encodeURIComponent","join","assign","_this3","replace","RegExp","value"],"mappings":"wfAMqBA,oEASZC,QAAU,QAMVC,QAAU,QAMVC,KAAO,QAMPC,QAAU,GAGC,CAAC,MAAO,OAAQ,QAAS,MAAO,UAGxCC,QAAQ,SAACC,KACVA,GAAU,mBAAWC,EAAKC,QAAQF,EAAQG,uEAa1CH,yDAAS,MAAOG,yDAAU,KAC8BA,EAAvDC,GAAAA,aAAK,OAAkDD,EAA9CE,MAAAA,aAAQ,SAAsCF,EAAhCG,KAAAA,aAAO,SAAyBH,EAAnBI,QAAAA,aAAU,MAClDC,EAAMC,KAAKb,YAAca,KAAKb,YAAWa,KAAKZ,SAAaY,KAAKZ,YAEhEO,MACOI,MAAOJ,GAIdC,SACOG,EAAMC,KAAKC,MAAML,IAGP,oBAAPM,IAAsBA,GAAGT,QACnC,IAAIU,QAAQ,SAACC,EAASC,MACnBZ,QAAQ,KACJa,EAAKpB,QAAUa,SACZO,EAAKjB,sBAEPQ,UACG,YACiC,OAAnCU,EAAIC,WAAa,IAAIC,OAAO,KACvBF,KAEDA,SAGLF,MAGRK,MAAM,SACGV,KAAKd,gBACLc,KAAKX,sCAIRQ,kCASLc,UACAA,GAAQC,OAAOC,KAAKF,GAAKG,OAIvB,IAAMF,OAAOC,KAAKF,GAAKI,IAAI,mBAAUC,MAAOC,mBAAmBN,EAAIK,MAASE,KAAK,KAH/E,yCAUF9B,yDAAO,eACTA,KAAUY,KAAKZ,SAAQA,EAErBY,wCAOGX,iBACH8B,OAAOnB,KAAKX,QAASA,GAErBW,kDAOAN,yDAAU,iBACVmB,KAAKnB,GAASJ,QAAQ,cACtBF,KAAOgC,EAAKhC,KAAKiC,QAAQ,IAAIC,WAAWC,MAAU,OAAQ7B,EAAQ6B,MAGlEvB"}